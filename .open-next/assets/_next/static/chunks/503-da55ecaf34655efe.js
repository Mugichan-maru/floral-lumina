"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[503],{1408:(e,t,r)=>{r.d(t,{N:()=>y});var n=r(5155),s=r(2115),i=r(296),o=r(4416),l=r(6553),a=r(9686),u=r(1402),c=r(3127);class d extends s.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,r=(0,u.s)(e)&&e.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=r-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function p(e){let{children:t,isPresent:r,anchorX:i,root:o}=e,l=(0,s.useId)(),a=(0,s.useRef)(null),u=(0,s.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:p}=(0,s.useContext)(c.Q);return(0,s.useInsertionEffect)(()=>{let{width:e,height:t,top:n,left:s,right:c}=u.current;if(r||!a.current||!e||!t)return;a.current.dataset.motionPopId=l;let d=document.createElement("style");p&&(d.nonce=p);let f=null!=o?o:document.head;return f.appendChild(d),d.sheet&&d.sheet.insertRule('\n          [data-motion-pop-id="'.concat(l,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat("left"===i?"left: ".concat(s):"right: ".concat(c),"px !important;\n            top: ").concat(n,"px !important;\n          }\n        ")),()=>{f.contains(d)&&f.removeChild(d)}},[r]),(0,n.jsx)(d,{isPresent:r,childRef:a,sizeRef:u,children:s.cloneElement(t,{ref:a})})}let f=e=>{let{children:t,initial:r,isPresent:i,onExitComplete:l,custom:u,presenceAffectsLayout:c,mode:d,anchorX:f,root:m}=e,E=(0,o.M)(h),C=(0,s.useId)(),y=!0,R=(0,s.useMemo)(()=>(y=!1,{id:C,initial:r,isPresent:i,custom:u,onExitComplete:e=>{for(let t of(E.set(e,!0),E.values()))if(!t)return;l&&l()},register:e=>(E.set(e,!1),()=>E.delete(e))}),[i,E,l]);return c&&y&&(R={...R}),(0,s.useMemo)(()=>{E.forEach((e,t)=>E.set(t,!1))},[i]),s.useEffect(()=>{i||E.size||!l||l()},[i]),"popLayout"===d&&(t=(0,n.jsx)(p,{isPresent:i,anchorX:f,root:m,children:t})),(0,n.jsx)(a.t.Provider,{value:R,children:t})};function h(){return new Map}var m=r(5601);let E=e=>e.key||"";function C(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}let y=e=>{let{children:t,custom:r,initial:a=!0,onExitComplete:u,presenceAffectsLayout:c=!0,mode:d="sync",propagate:p=!1,anchorX:h="left",root:y}=e,[R,T]=(0,m.xQ)(p),g=(0,s.useMemo)(()=>C(t),[t]),A=p&&!R?[]:g.map(E),_=(0,s.useRef)(!0),I=(0,s.useRef)(g),x=(0,o.M)(()=>new Map),[O,P]=(0,s.useState)(g),[v,M]=(0,s.useState)(g);(0,l.E)(()=>{_.current=!1,I.current=g;for(let e=0;e<v.length;e++){let t=E(v[e]);A.includes(t)?x.delete(t):!0!==x.get(t)&&x.set(t,!1)}},[v,A.length,A.join("-")]);let w=[];if(g!==O){let e=[...g];for(let t=0;t<v.length;t++){let r=v[t],n=E(r);A.includes(n)||(e.splice(t,0,r),w.push(r))}return"wait"===d&&w.length&&(e=w),M(C(e)),P(g),null}let{forceRender:L}=(0,s.useContext)(i.L);return(0,n.jsx)(n.Fragment,{children:v.map(e=>{let t=E(e),s=(!p||!!R)&&(g===v||A.includes(t));return(0,n.jsx)(f,{isPresent:s,initial:(!_.current||!!a)&&void 0,custom:r,presenceAffectsLayout:c,mode:d,root:y,onExitComplete:s?void 0:()=>{if(!x.has(t))return;x.set(t,!0);let e=!0;x.forEach(t=>{t||(e=!1)}),e&&(null==L||L(),M(I.current),p&&(null==T||T()),u&&u())},anchorX:h,children:e},t)})})}},7740:(e,t,r)=>{r.d(t,{CartProvider:()=>u,_:()=>c});var n=r(5155),s=r(2115);let i=e=>({totalItems:e.reduce((e,t)=>e+t.quantity,0),totalPrice:e.reduce((e,t)=>e+(e=>{let t=e.match(/[\d,]+/);return t?parseInt(t[0].replace(/,/g,""),10):0})(t.product.price)*t.quantity,0)}),o={items:[],isOpen:!1,totalItems:0,totalPrice:0},l=(e,t)=>{switch(t.type){case"ADD_ITEM":{let r,{product:n,quantity:s,color:o}=t.payload,l="".concat(n.id,"-").concat(o||"default"),a=e.items.findIndex(e=>e.id===l);if(a>=0)r=e.items.map((e,t)=>t===a?{...e,quantity:e.quantity+s}:e);else{let t={id:l,product:n,quantity:s,selectedColor:o,addedAt:Date.now()};r=[...e.items,t]}let{totalItems:u,totalPrice:c}=i(r);return{...e,items:r,totalItems:u,totalPrice:c}}case"REMOVE_ITEM":{let r=e.items.filter(e=>e.id!==t.payload.id),{totalItems:n,totalPrice:s}=i(r);return{...e,items:r,totalItems:n,totalPrice:s}}case"UPDATE_QUANTITY":{let{id:r,quantity:n}=t.payload;if(n<=0)return l(e,{type:"REMOVE_ITEM",payload:{id:r}});let s=e.items.map(e=>e.id===r?{...e,quantity:n}:e),{totalItems:o,totalPrice:a}=i(s);return{...e,items:s,totalItems:o,totalPrice:a}}case"CLEAR_CART":return{...e,items:[],totalItems:0,totalPrice:0};case"TOGGLE_CART":return{...e,isOpen:!e.isOpen};case"OPEN_CART":return{...e,isOpen:!0};case"CLOSE_CART":return{...e,isOpen:!1};case"LOAD_CART":{let{totalItems:r,totalPrice:n}=i(t.payload);return{...e,items:t.payload,totalItems:r,totalPrice:n}}default:return e}},a=(0,s.createContext)(void 0);function u(e){let{children:t}=e,[r,i]=(0,s.useReducer)(l,o);return(0,s.useEffect)(()=>{let e=sessionStorage.getItem("floral-lumina-cart");if(e)try{let t=JSON.parse(e);i({type:"LOAD_CART",payload:t})}catch(e){console.error("カートデータの読み込みに失敗しました:",e)}},[]),(0,s.useEffect)(()=>{sessionStorage.setItem("floral-lumina-cart",JSON.stringify(r.items))},[r.items]),(0,n.jsx)(a.Provider,{value:{state:r,addItem:(e,t,r)=>{i({type:"ADD_ITEM",payload:{product:e,quantity:t,color:r}})},removeItem:e=>{i({type:"REMOVE_ITEM",payload:{id:e}})},updateQuantity:(e,t)=>{i({type:"UPDATE_QUANTITY",payload:{id:e,quantity:t}})},clearCart:()=>{i({type:"CLEAR_CART"})},toggleCart:()=>{i({type:"TOGGLE_CART"})},openCart:()=>{i({type:"OPEN_CART"})},closeCart:()=>{i({type:"CLOSE_CART"})}},children:t})}function c(){let e=(0,s.useContext)(a);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}}}]);